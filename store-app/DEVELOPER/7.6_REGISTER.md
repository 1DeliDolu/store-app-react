Bu dosya `src/api/apiClient.js` ve `src/pages/Register.jsx` dosyalarına yapılan değişiklikleri ve bu değişikliklerin nasıl çalıştığını ayrıntılı şekilde açıklar. Amaç: kayıt (register) akışının backend ile nasıl haberleştiğini, hata yönetimini, ve geliştirici olarak hangi iyileştirmeleri yapabileceğinizi anlatmaktır.

Özet değişiklikler

- `src/api/apiClient.js` içine `account` adlı küçük bir API wrapper eklendi:

  - `register(data)` → POST `/users/register`
  - `login(data)` → POST `/users/login`
  - `getUser()` → GET `/users/getUser`

- `src/pages/Register.jsx` dosyasında `useForm` ile form yönetimi var ve `handleForm` içinde artık `requests.account.register(data)` çağrısı yapılıyor. Başarılıysa `navigate('/login')` ile giriş sayfasına yönlendiriliyor.

Detaylı açıklama — `apiClient.js`

- Temel yapı zaten mevcuttu: `methods` (get/post/put/delete), `products`, `cart`, `errors`. Yeni `account` wrapper bu yapıya eklendi ve `requests` objesine dahil edildi.
- Önemli ayarlar:
  - `axios.defaults.baseURL = "http://localhost:5001/"` — tüm istekler bu kök üzerinden yapılır.
  - `axios.defaults.withCredentials = true` — cookie/oturum yönetimi gerektiren endpoint'ler için gereklidir.
  - Response interceptor: sunucudan dönen hata kodlarını merkezi olarak yakalar. Özellikle dikkat:
    - 400/401: toast üzerinden gösteriliyor (`toast.error(data.message)`).
    - 403: eğer `data.errors` varsa, interceptor bu hataları bir `result` objesine dönüştürüp throw ediyor. Böylece `catch` bloğunda bu özel yapı yakalanabilir ve form alan hatalarına çevrilebilir.
    - 404/500: uygulama router'ı ile hata sayfalarına yönlendirme yapılıyor.

Neden `account` ekledik?

- `Register.jsx` ve `Login.jsx` gibi sayfaların backend ile konuşabilmesi için erişilebilir bir `requests.account.register(...)` methodu gerekiyordu. Sunucuda `server/routes/users.js` içinde `/register` ve `/login` rotaları zaten mevcut; bu wrapper rotaları kolay kullanılabilir hale getirir.

Detaylı açıklama — `Register.jsx`

- `useForm` ile form state yönetiliyor:
  - `register`, `handleSubmit`, `formState: { errors, isValid }` destructuring yapılmış.
  - `defaultValues` ile alanların başlangıç değerleri sağlanmış.
- `handleForm(data)` fonksiyonu:
  - `requests.account.register(data)` çağrısı yapar.
  - Başarılı ise `navigate('/login')` ile kullanıcı login sayfasına yönlendirilir.
  - Hata durumunda `catch((error) => console.log(error))` ile hata konsola yazılıyor; bu geliştirme aşamasında yeterli, ancak production için daha iyi UX önerileri aşağıda.

Sunucu tarafı beklentisi ve cevap örnekleri

- Sunucuda `/users/register` rota kodu `server/routes/users.js` içinde açık:
  - Aynı kullanıcı adı varsa 400 döner: `{ message: "Username already exists" }`
  - Başarılı kayıtta 201 ve `{ message: "User saved." }` döner.

Hata yönetimi — interceptor ile gelen özel hata objesi

- Interceptor, `403` durumunda `data.errors` varsa bu hataları toplayıp `throw result;` yapıyor. Bu `result` nesnesi şu yapıda olabilir:

  {
  errors: [...],
  message: '...'
  }

- `Register.jsx` içindeki `catch(error)` bloğunda bu yapıyı kontrol edip alan bazlı hataları `react-hook-form`'un `setError` API'siyle form alanlarına atayabilirsiniz. Örnek:

```js
requests.account.register(data)
	.then(...)
	.catch((err) => {
		if (err && err.errors) {
			// err.errors dizisini parse edip her bir alana setError ile yansıtın
		} else {
			// genel hata gösterimi (toast veya fieldless hata)
		}
	})
```

Örnek: alan bazlı hata gösterimi

```js
// varsayım: err.errors = [ { field: 'email', message: 'invalid' }, ... ]
err.errors.forEach((e) =>
  setError(e.field, { type: "server", message: e.message })
);
```

(Not: mevcut interceptor `throw result` yapısı sunucunun `data.errors` yapısına bağlıdır. Eğer backend farklı bir yapı döndürüyorsa burayı ona göre parse edin.)

Geliştirme önerileri & iyi uygulamalar

1. `isSubmitting` kullanın

   - `useForm`'un `formState.isSubmitting` özelliğini kullanarak submit sırasında butonu disable edin ve `Loading` gösterin. Bu, çoklu submit isteklerini engeller.

2. Alan bazlı hata gösterimi

   - Interceptor'ın `errors` dizisini `setError` ile form alanlarına yansıtın; kullanıcı hangi alanın neden hatalı olduğunu görür.

3. Güvenlik

   - `console.log(result)` içindeki hassas verileri kaldırın; parolaları loglamayın.
   - `axios.defaults.withCredentials = true` olduğu için backend CORS ve cookie ayarlarının doğru olduğundan emin olun.

4. Kullanıcı deneyimi (UX)

   - Başarılı kayıt sonrası otomatik login: isterseniz register sonrası kullanıcıyı otomatik authenticate edip token ile redirect sağlayabilirsiniz (server login token döndürüyor ise).
   - Kayıt başarısızsa kullanıcıya açık ve alan bazlı geri bildirim verin.

5. Test etme adımları
   - Sunucuyu (`server/server.js`) çalıştırın.
   - Tarayıcıda Register formunu doldurup submit edin.
   - Başarılı durumda `/login` sayfasına yönlendirildiğinden emin olun.
   - Aynı kullanıcı adı ile tekrar kayıt deneyin; interceptor toast veya catch bloğunuz hata mesajını göstermeli.

Kod örnekleri — `Register.jsx` içinde önerilen hata işleme (kısa)

```js
function handleForm(data) {
	// async/await versiyonu
	try {
		await requests.account.register(data);
		navigate('/login');
	} catch (err) {
		if (err && err.errors) {
			// server-side validation errors
			err.errors.forEach(e => setError(e.field, { type: 'server', message: e.message }));
		} else {
			// genel hata
			toast.error(err.message || 'Kayıt sırasında bir hata oluştu');
		}
	}
}
```

Özet kontrol listesi (hızlı)

- [ ] `apiClient.js` içindeki `account` metodları beklendiği gibi çalışıyor mu? (POST `/users/register`)
- [ ] Register formunda `isSubmitting` ve `setError` ile daha iyi UX sağlandı mı?
- [ ] Interceptor'ın throw ettiği `result` nesnesinin yapısı backend ile uyumlu mu?
- [ ] Production için `console.log`'lar kaldırıldı mı?

Eğer isterseniz şimdi `Register.jsx` içinde önerdiğim `isSubmitting` + `setError` + async/await örneğini otomatik olarak uygularım ve küçük bir test çalıştırıp sonucu raporlarım.
