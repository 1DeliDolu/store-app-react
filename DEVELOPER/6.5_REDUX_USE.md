# 6.5 Redux Kullanımı — `Home.jsx`, `Counter.jsx`, `counterSlice.js` Açıklaması

Bu doküman `src/pages/Home.jsx`, `src/pages/counter/Counter.jsx` ve `src/pages/counter/counterSlice.js` dosyalarının ne yaptığını, satır satır nasıl çalıştığını, hangi hook'ların kullanıldığını, olası hataları ve çözüm önerilerini modern bir formatta açıklar.

Ön koşul: proje kökünde `npm install` ile bağımlılıkların yüklü olduğundan emin olun. Eğer Redux Toolkit ya da react-redux yüklü değilse şu komutları çalıştırın:

```bash
npm install @reduxjs/toolkit react-redux @mui/material @emotion/react @emotion/styled
```

---

## Dosya: `src/pages/Home.jsx`

İçerik:

```javascript
import Counter from "./counter/Counter";

export default function HomePage() {
  return (
    <div>
      <h1>HomePage</h1>
      <Counter />
    </div>
  );
}
```

Açıklama:

- `Counter` bileşeni `./counter/Counter` yolundan import ediliyor. Bu bileşen aynı klasörde (`pages/counter`) yer alan `Counter.jsx`'dir.
- `HomePage` basitçe bir başlık ve `Counter` bileşenini render eder. Böylece sayaç `Home` sayfasında gösterilir.

Notlar:

- Eğer `Counter` bileşenini başka bir yol veya farklı isimle taşırsanız, import yolunu güncelleyin.

---

## Dosya: `src/pages/counter/counterSlice.js`

İçerik (mevcut):

```javascript
import { createSlice } from "@reduxjs/toolkit";

const initialState = {
  value: 0,
};

export const counterSlice = createSlice({
  name: "counter",
  initialState,
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    },
    incrementByAmount: (state, action) => {
      state.value += action.payload;
    },
  },
});

export const { increment, decrement, incrementByAmount, setValuebyUser } =
  counterSlice.actions;

export default counterSlice.reducer;
```

Satır satır açıklama:

- `import { createSlice } from '@reduxjs/toolkit';`
  - Redux Toolkit'in `createSlice` API'si, action tipi, action creator ve reducer'ı tek bir yerde tanımlamayı kolaylaştırır.
- `initialState`
  - Slice'ın başlangıç state'ini belirler. Burada `value` alanı sayaç değeridir.
- `createSlice({...})`
  - `name`: Slice adına göre action type'ları otomatik oluşturulur (örn. `counter/increment`).
  - `reducers`: Reducer fonksiyonları. Toolkit altında bu fonksiyonlar mutable yazılabilir (immer ile güvenli hale getirilir).
    - `increment`: `value`'yu 1 arttırır.
    - `decrement`: `value`'yu 1 azaltır.
    - `incrementByAmount`: `action.payload` kadar arttırır.
- `export const { increment, decrement, incrementByAmount, setValuebyUser } = counterSlice.actions;`
  - Burada otomatik oluşturulan action creator'lar dışa aktarılıyor. Ancak dikkat: `setValuebyUser` reducer olarak tanımlı değil. Bu satır runtime'da `undefined` hata ya da beklenmeyen davranışa yol açabilir.

Hata/eksiklik ve çözüm önerisi:

- Problem: `setValuebyUser` action'ı `reducers` içinde tanımlı değil ama export edilmeye çalışılmış. Bu, `import { setValuebyUser } from './counterSlice'` yapıldığında `undefined` döner ve dispatch edilmeye çalışılırsa hata oluşturur.
- Çözüm: İki seçenekten birini uygulayın:
  1.  Eğer `setValuebyUser` gerekiyorsa, `reducers` içine şu reducer'ı ekleyin:

```javascript
setValuebyUser: (state, action) => {
	state.value = Number(action.payload) || 0;
},
```

    2. Eğer gerek yoksa, export satırından `setValuebyUser`'ı çıkarın:

```javascript
export const { increment, decrement, incrementByAmount } = counterSlice.actions;
```

---

## Dosya: `src/pages/counter/Counter.jsx`

İçerik (mevcut):

```javascript
import { Button, Typography } from "@mui/material"; // MUI bileşenleri
import React, { use } from "react";
import { useDispatch, useSelector } from "react-redux"; // redux store ile etkileşim için hook'lar
import { decrement, increment, incrementByAmount } from "./counterSlice";

export default function Counter() {
  const value = useSelector((state) => state.counter.value); // state içinden counter slice'ının value'sunu al
  const dispatch = useDispatch(); // action dispatch etmek için kullan
  const [amount, setAmount] = React.useState(0);

  return (
    <div>
      <Typography variant="h3" component="h3" align="center" mt={5}>
        {value}
      </Typography>
      {/* sayacı göster */}
      <Button
        variant="contained"
        color="primary"
        onClick={() => dispatch(increment())}
      >
        Increment
      </Button>
      {/* Artırma butonu */}
      <Button
        variant="contained"
        color="secondary"
        onClick={() => dispatch(decrement())}
        style={{ marginLeft: "10px" }}
      >
        Decrement
      </Button>
      {/* Kullanıcının girdiği miktar */}
      <input
        type="number"
        value={amount}
        onChange={(e) => setAmount(Number(e.target.value))}
        style={{ marginLeft: "10px", width: "80px" }}
      />
      <Button
        variant="contained"
        onClick={() => dispatch(incrementByAmount(Number(amount)))}
        style={{ marginLeft: "10px" }}
      >
        Increment by {amount}
      </Button>
    </div>
  );
}
```

Satır satır ve önemli noktalar:

- `import { Button, Typography } from "@mui/material";`
  - MUI bileşenleri kullanılıyor. Projede MUI varsa görsel bileşenler çalışır.
- `import React, { use } from "react";`
  - Buradaki `use` named import'u doğru değil: React'ta `use` adında bir hook yok (React 18'de `use` deneysel, genelde kullanılmaz) ve bu import gereksiz. Bu satır yerine `import React from 'react';` veya `import React, { useState } from 'react';` yazın. Zaten `React.useState` kullanılıyor, bu yüzden `use`'u kaldırmak en hızlı çözümdür.
- `const value = useSelector((state) => state.counter.value);`
  - Redux store'dan sayaç değerini okur. Eğer `store`'da `counter` reducer'ı eklenmemişse bu ifade `undefined` dönebilir — store yapılandırmasını kontrol edin (`src/store/store.js`).
- `const dispatch = useDispatch();`
  - Action göndermek için dispatch fonksiyonunu alır.
- `const [amount, setAmount] = React.useState(0);`
  - Kullanıcının girdiği miktarı local component state'inde tutar.
- Butonlar ve input
  - `Increment` ve `Decrement` butonları ilgili action'ları dispatch eder.
  - `Increment by {amount}` butonu `incrementByAmount(Number(amount))` dispatch eder. `Number(amount)` ekstra güvenlik sağlar.

Potansiyel hatalar ve düzeltmeler:

- `import React, { use } from "react";` satırını kaldırın veya düzeltin:

```javascript
import React from "react";
// veya
import React, { useState } from "react";
```

- Input validation: `Number(amount)` NaN olabilir. Butona basmadan önce input'un geçerli bir sayı olduğundan emin olun:

```javascript
const parsed = Number(amount);
if (!Number.isFinite(parsed)) return; // veya kullanıcıya hata göster
dispatch(incrementByAmount(parsed));
```

---

## Store entegrasyonu kontrolü

`src/store/store.js` içinde `counter` reducer'ının doğru eklendiğinden emin olun. Örnek:

```javascript
import { configureStore } from "@reduxjs/toolkit";
import counterReducer from "../pages/counter/counterSlice";

export const store = configureStore({
  reducer: {
    counter: counterReducer,
  },
});
```

Not: `counterSlice.js` dosyası `export default counterSlice.reducer;` yaptığı için `import counterReducer from '...';` kullanmak sade ve güvenlidir.

---

## Smoke test / Çalıştırma adımları

1. Paketleri yükleyin (yukarıdaki `npm install` komutu).
2. Gerekli düzeltmeleri yapın (aşağıdaki "Hızlı düzeltmeler").
3. Uygulamayı çalıştırın:

```bash
npm run dev
```

4. Tarayıcıyı açıp `Home` sayfasına gidin; sayaç görünmeli ve butonlar çalışmalıdır.

Hızlı düzeltmeler (özet):

- `counterSlice.js` içindeki export satırından `setValuebyUser`'ı kaldırın ya da reducer'ı ekleyin.
- `Counter.jsx`'de `import React, { use } from 'react';` satırını düzeltin.

---

## Test önerileri

- Reducer birim testi (Jest örneği):

```javascript
import counterReducer, {
  increment,
  decrement,
  incrementByAmount,
} from "./counterSlice";

test("should handle increment", () => {
  const initialState = { value: 0 };
  const nextState = counterReducer(initialState, increment());
  expect(nextState.value).toBe(1);
});
```

---

## Özet

- `Home.jsx` sayfada `Counter` bileşenini render eder.
- `counterSlice.js` sayaç state'ini ve işlem reducer'larını tanımlar; ancak export satırında tanımsız bir action export edilmemeli.
- `Counter.jsx` React-Redux hook'ları (`useSelector`, `useDispatch`) ile store ile etkileşir; mevcut kodda küçük import/validation hataları bulunuyor ve bunlar kolayca düzeltilebilir.

Eğer isterseniz ben bu küçük düzeltmeleri (1) `counterSlice.js` export satırını temizleme ve/veya (2) `Counter.jsx` import düzeltmesini otomatik olarak workspace'e uygulayıp uygulamayı başlatıp kısa bir smoke-test çalıştırabilirim.
