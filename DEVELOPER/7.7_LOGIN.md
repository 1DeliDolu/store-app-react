Bu doküman `src/pages/Login.jsx` dosyasındaki kodu adım adım açıklar, mevcut davranışı, güvenlik hususlarını, hata yönetimini ve iyileştirme önerilerini içerir.

1. Dosyanın ana işlevi

- `Login.jsx` kullanıcı giriş formunu render eder ve form submit edildiğinde backend'e login isteği gönderir. Başarılı giriş sonrası dönen sonuç `localStorage`'a kaydedilir ve ana sayfaya (`/`) yönlendirme yapılır.

2. Kullanılan kütüphaneler ve önemli parçalar

- `react-hook-form` (`useForm`) : form state ve validasyon yönetimi için kullanılıyor. `register`, `handleSubmit`, `formState: { errors, isValid }` destructure ediliyor.
- `requests.account.login` : `src/api/apiClient.js` içindeki wrapper, POST `/users/login` endpoint'ine istek yapar.
- `useNavigate` : giriş sonrası sayfa yönlendirmesi için React Router hook'u.

3. Form yapılandırması ve validasyon

- `useForm({ defaultValues: { username: "", password: "" } })` — iki alan için başlangıç değerleri belirlenmiş.
- `register` ile alanlara doğrulama kuralları eklenmiş:
  - `username`: required, minLength 3
  - `password`: required, minLength 6
- `TextField`'larda `error={!!errors.username}` ve `helperText={errors.username?.message}` gibi alan bazlı hata gösterimi sağlanmış.

4. Submit akışı

- Form submit edildiğinde `handleSubmit(handleForm)` çağrılır. `handleForm(data)` şu adımları yapar:
  1.  `requests.account.login(data)` ile API'ye istek gönderir.
  2.  Başarılı ise `localStorage.setItem('user', JSON.stringify(result))` ile dönen sonucu saklar. (Not: saklanan nesnenin içeriğine dikkat edin; eğer token içeriyorsa, güvenlik notlarına bakın.)
  3.  `navigate('/')` ile ana sayfaya yönlendirir.
  4.  Hata durumunda `catch((error) => console.log(error))` ile konsola yazılıyor.

5. Güvenlik ve saklama önerileri

- `localStorage`'a doğrudan tüm sonucun (özellikle token'ın) kaydedilmesi XSS riskleri nedeniyle dikkat gerektirir. Daha güvenli yaklaşımlar:
  - HttpOnly cookie: token'ı sunucu cookie olarak set ediyorsa `axios.defaults.withCredentials = true` ile cookie kullanın (güncel projede bu aktif).
  - Eğer token localStorage'da saklanacaksa, token'ı minimal tutun ve hassas verileri saklamayın.
  - Cross-Site Scripting (XSS) risklerini azaltmak için uygulamada input/output sanitization ve CSP politikaları uygulayın.

6. Hata yönetimi ve kullanıcıya geri bildirim

- Mevcut kod sadece `console.log(error)` yapıyor. Kullanıcıya daha iyi geri bildirim için:
  - `toast.error(...)` ile bir hata bildirimi gösterin (projede toast zaten kullanılıyor).
  - Eğer backend validation hataları interceptor tarafından özel bir `result` objesi ile fırlatılıyorsa, bu objeyi parse edip `setError` ile alan bazlı hatayı gösterin.

Örnek (catch içinde setError kullanımı):

```js
try {
  const result = await requests.account.login(data);
  localStorage.setItem("user", JSON.stringify(result));
  navigate("/");
} catch (err) {
  if (err && err.errors) {
    // err.errors: [{ field, message }, ...] varsayımıyla
    err.errors.forEach((e) =>
      setError(e.field, { type: "server", message: e.message })
    );
  } else {
    toast.error(err.message || "Giriş başarısız");
  }
}
```

7. UX iyileştirmeleri

- `isValid` ve `mode`: `useForm` varsayılan `mode`'u `onSubmit` olduğu için `isValid` submit öncesinde true olmayabilir. Eğer butonu alan doğrulamaları tamamlandıkça açmak istiyorsanız `useForm({ mode: 'onChange' })` kullanın.
- `isSubmitting`: async submit durumunu kullanarak butonu disable edin ve `Loading` bileşeni gösterin:

```jsx
const {
  formState: { isSubmitting },
} = useForm({ mode: "onChange" });

<Button type="submit" disabled={isSubmitting || !isValid}>
  {isSubmitting ? <CircularProgress size={20} /> : "Submit"}
</Button>;

{
  isSubmitting && <Loading message="Giriş yapılıyor..." />;
}
```

8. Token yönetimi önerisi

- Eğer backend `login` isteğine bir JWT token döndürüyor ise, iki yaygın strateji vardır:
  - Sunucunun `Set-Cookie` ile HttpOnly cookie set etmesi (en güvenli). Frontend sadece `withCredentials` ile cookie gönderir/okumaz.
  - Frontend'e token döndürülürse, bunu localStorage/sessionStorage'a koyabilirsiniz; ancak XSS riskine dikkat edin. Token'ı saklama yerine her istek için kısa ömürlü refresh token mekanizmaları düşünebilirsiniz.

9. Örnek geliştirici checklist

- [ ] `console.log(result)` production'a gitmeden kaldırıldı mı?
- [ ] `isSubmitting` ile çift submit engellendi mi?
- [ ] Hatalarda kullanıcı dostu mesajlar gösteriliyor mu (toast veya field-level)?
- [ ] Token güvenli şekilde saklanıyor mu (HttpOnly cookie tercih ediliyor mu)?

10. Sonuç

- `Login.jsx` küçük ve doğru şekilde `react-hook-form` kullanıyor; ancak güvenlik (token saklama), hata yönetimi (setError/toast) ve UX (isSubmitting, mode) açısından birkaç iyileştirme önerdim. İsterseniz bu önerilerden birkaçını doğrudan kodda uygulayıp test edebilirim.
